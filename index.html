<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Do You Want to Play? 👻</title>
<style>
  body{background:#000;color:#eaeaea;font-family:monospace;padding:30px;max-width:760px;margin:auto}
  h1{color:#ff4444;text-align:center}
  #start-screen{text-align:center;margin-top:60px}
  #story{white-space:pre-wrap;min-height:180px;font-size:1.05rem;margin:18px 0}
  .choice-btn{display:block;width:100%;padding:10px;border-radius:8px;border:1px solid #444;background:#111;color:#eee;margin:8px 0;cursor:pointer;text-align:left}
  #mute-btn{position:fixed;right:14px;top:14px;padding:6px 10px;border-radius:8px;background:#111;border:1px solid #444;color:#fff;cursor:pointer}
  @keyframes screenFlicker {
  0%, 100% { background-color: #000; }
  20%, 80% { background-color: #111; }
  40%, 60% { background-color: #222; }
}

.flicker {
  animation: screenFlicker 1s ease-in-out;
}
</style>
</head>
<body>
  <h1>💻 Do You Want to Play? 💀</h1>

  <div id="start-screen">
    <p>It’s 6:59 PM. The office is empty. Do you dare to start?</p>
    <button id="start-btn" class="choice-btn">▶️ Start Game</button>
  </div>

  <div id="game" style="display:none">
    <div id="story"></div>
    <div id="choices"></div>
  </div>

  <button id="mute-btn" style="display:none">🔊 Sound On</button>

  <!-- Local audio files (added to /assets/audio/) -->
  <audio id="bgMusic" src="assets/audio/bg.mp3" loop preload="auto"></audio>
  <audio id="typingSound" src="assets/audio/typing.mp3" preload="auto"></audio>
  <audio id="flickerSound" src="assets/audio/flicker.mp3" preload="auto"></audio>
  <audio id="whisperSound" src="assets/audio/whisper.mp3" preload="auto"></audio>
  <audio id="footstep" src="assets/audio/whisper.mp3" preload="auto"></audio>


<script>
const story = {
  "start": {
    "text": "👀 *6:59 PM.* Everyone’s gone. The hum of the lights feels louder than usual. You’re about to shut down your PC when an email pops up:\n*From:* unknown@officecorp.com\n*Subject:* Do you want to play?",
    "choices": [
      {"text": "Open the email 📧", "next": "open_email"},
      {"text": "Ignore it 🙈", "next": "ignore_email"}
    ]
  },
  "open_email": {
    "text": "📩 The email simply says: *‘We know you stayed late. Let’s play a game. Find the red folder.’*\nA faint *footstep* echoes down the hall — but you’re alone... right?",
    "choices": [
      {"text": "Search your desk 🗄️", "next": "search_desk"},
      {"text": "Check the hallway 🚶", "next": "search_hallway"}
    ]
  },
  "ignore_email": {
    "text": "⚡ The lights flicker. Another message appears instantly: *‘You can’t hide from me.’*\nSomething moves on your monitor’s reflection — but nothing’s behind you.",
    "choices": [
      {"text": "Go check the email 📧", "next": "open_email"},
      {"text": "Hide under your desk 🪑", "next": "hide_desk"}
    ]
  },
  "search_desk": {
    "text": "You open your drawer. A *red folder* slides forward on its own. Inside, a note reads:\n*‘When the clock strikes 10, you must choose your door.’* ⏰\nThe second hand ticks louder with every breath.",
    "choices": [
      {"text": "Head to the break room 🍵", "next": "break_room"},
      {"text": "Try the exit door 🚪", "next": "exit_door"}
    ]
  },
  "search_hallway": {
    "text": "The hallway lights buzz overhead. A silhouette stands at the far end, motionless. When you blink — it’s gone.\nA door creaks open near the conference room.",
    "choices": [
      {"text": "Follow the sound 👤", "next": "conference_room"},
      {"text": "Retreat to your desk 🖥️", "next": "search_desk"}
    ]
  },
  "hide_desk": {
    "text": "You crawl under your desk. Silence… then the printer starts printing a page by itself: *‘Stand up.’* 🖨️\nThe paper keeps sliding out — blank, blank, blank — until one shows your name.",
    "choices": [
      {"text": "Stand up 🧍", "next": "search_desk"},
      {"text": "Stay hidden 🫣", "next": "stay_hidden"}
    ]
  },
  "break_room": {
    "text": "You enter the break room. The clock reads *9:59.* Three coffee cups sit in a row — one trembling slightly.\nA whisper brushes your ear: *‘Choose carefully.’*",
    "choices": [
      {"text": "Pick left cup 🟢", "next": "key_left"},
      {"text": "Pick middle cup 🟡", "next": "key_middle"},
      {"text": "Pick right cup 🔴", "next": "key_right"}
    ]
  },
  "exit_door": {
    "text": "You reach the exit. The glass reflects the office behind you — except the reflection isn’t moving.\nIt slowly smiles. 😳",
    "choices": [
      {"text": "Run back to your desk", "next": "search_desk"},
      {"text": "Try another exit 🏃", "next": "other_exit"}
    ]
  },
  "conference_room": {
    "text": "The door creaks open. It’s dark. A chair slowly turns toward you — empty.\nThen the overhead projector flickers on by itself, showing a slide: *‘Wrong room.’*",
    "choices": [
      {"text": "Run to your desk", "next": "search_desk"},
      {"text": "Leave quickly 🙅", "next": "other_exit"}
    ]
  },
  "stay_hidden": {
    "text": "From under the desk, you hear faint typing on your keyboard. A soft whisper follows:\n*‘Time’s up.’* The monitor glows with your own login — but the hands on the keyboard aren’t yours. ⏱️",
    "choices": [
      {"text": "Crawl toward the hallway 🐛", "next": "conference_room"},
      {"text": "Peek at the desk 👀", "next": "search_desk"}
    ]
  },
  "key_left": {
    "text": "✅ The left cup hides a small brass key. The whisper fades. You sprint to the exit, unlock it, and feel the cool night air — free at last.\n…until your phone buzzes: *‘See you tomorrow, player one.’* 🎉",
    "choices": []
  },
  "key_middle": {
    "text": "❌ The middle cup rattles — empty. The lights flicker, then cut out.\nWhen they return, your reflection in the microwave is smiling back. And it doesn’t stop smiling. 😨",
    "choices": []
  },
  "key_right": {
    "text": "❌ The right cup contains only a candy — and a note beneath it: *‘Too sweet. Too slow.’*\nThe break room door locks behind you as the clock strikes 10. Tick. Tick. Silence. ⏰",
    "choices": []
  },
  "other_exit": {
    "text": "✅ You burst into the emergency stairwell. Freedom!\nYou laugh, catching your breath — until your office access card *slides under the stair door from the inside.* 🏃‍♂️💨",
    "choices": []
  }
};

const storyDiv = document.getElementById('story');
const choicesDiv = document.getElementById('choices');
const startScreen = document.getElementById('start-screen');
const game = document.getElementById('game');
const startBtn = document.getElementById('start-btn');
const muteBtn = document.getElementById('mute-btn');

const bgMusic = document.getElementById('bgMusic');
const typingSound = document.getElementById('typingSound');
const flickerSound = document.getElementById('flickerSound');
const whisperSound = document.getElementById('whisperSound');

let soundEnabled = true;

/* ---------- audio error logging (helps debugging) ---------- 
[bgMusic, typingSound, flickerSound, whisperSound].forEach(a => {
  a.addEventListener('error', (e) => {
    console.error('Audio load error for', a.src, e);
  });
});*/

/* ---------- Smooth Background Loop ---------- */
bgMusic.loop = true;
bgMusic.volume = 0.25;
bgMusic.addEventListener("ended", () => {
  bgMusic.currentTime = 0;
  bgMusic.play().catch(()=>{});
});

/* ---------- Helper: Safe sound play ---------- */
function playSafe(audio, volume = 1.0) {
  if (!soundEnabled || !audio) return;
  try {
    audio.currentTime = 0;
    audio.volume = volume;
    audio.play().catch(()=>{});
  } catch (e) {}
}

/* ---------- Typewriter ---------- */
function typeWriterEffect(text, callback){
  storyDiv.textContent = '';
  let i=0;
  playSafe(typingSound, 0.3);
  const t = setInterval(()=>{
    storyDiv.textContent += text.charAt(i) || '';
    i++;
    if(i>=text.length){
      clearInterval(t);
      typingSound.pause();
      typingSound.currentTime = 0;
      setTimeout(callback, 420);
    }
  }, 28);
}

/* ---------- Scene rendering ---------- */
function playScene(key) {
  const scene = story[key];
  if (!scene) return;
  choicesDiv.innerHTML = '';


  const textLower = scene.text.toLowerCase();
  const hasWhisper = textLower.includes("whisper");
  const hasFlicker = textLower.includes("flicker");

  typeWriterEffect(scene.text, () => {
    if (hasWhisper) playSafe(whisperSound, 0.6);
    if (hasFlicker) {
      playSafe(flickerSound, 0.7);
      document.body.classList.add('flicker');
      setTimeout(() => document.body.classList.remove('flicker'), 1200);
    }

    // Occasionally trigger faint flicker for tension
    if (!hasWhisper && !hasFlicker && Math.random() < 0.15) {
      playSafe(flickerSound, 0.3);
      document.body.classList.add('flicker');
      setTimeout(() => document.body.classList.remove('flicker'), 800);
    }

    // Build choices
    if (!scene.choices || scene.choices.length === 0) {
      const b = document.createElement('button');
      b.textContent = '🔁 Play Again';
      b.className = 'choice-btn';
      b.onclick = () => playScene('start');
      choicesDiv.appendChild(b);
    } else {
      scene.choices.forEach(c => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.textContent = c.text;
        btn.onclick = () => playScene(c.next);
        choicesDiv.appendChild(btn);
      });
    }
  });
}

/* ---------- Start Game ---------- */
startBtn.addEventListener('click', async () => {
  startScreen.style.display='none';
  game.style.display='block';
  muteBtn.style.display='inline-block';

  try {
    await bgMusic.play();
  } catch {
    console.warn("Autoplay blocked — will start after first gesture.");
  }

  playScene('start');
});

/* ---------- Mute Toggle ---------- */
muteBtn.addEventListener('click', () => {
  soundEnabled = !soundEnabled;
  muteBtn.textContent = soundEnabled ? '🔊 Sound On' : '🔇 Sound Off';
  if(soundEnabled){
    bgMusic.play().catch(()=>{});
  } else {
    bgMusic.pause();
    [typingSound, flickerSound, whisperSound].forEach(a => {a.pause();});
  }
});
</script>
</body>
</html>