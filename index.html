<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Do You Want to Play? üëª</title>
<style>
  body{background:#000;color:#eaeaea;font-family:monospace;padding:30px;max-width:760px;margin:auto}
  h1{color:#ff4444;text-align:center}
  #start-screen{text-align:center;margin-top:60px}
  #story{white-space:pre-wrap;min-height:180px;font-size:1.05rem;margin:18px 0}
  .choice-btn{display:block;width:100%;padding:10px;border-radius:8px;border:1px solid #444;background:#111;color:#eee;margin:8px 0;cursor:pointer;text-align:left}
  #mute-btn{position:fixed;right:14px;top:14px;padding:6px 10px;border-radius:8px;background:#111;border:1px solid #444;color:#fff;cursor:pointer}
  @keyframes screenFlicker {
  0%, 100% { background-color: #000; }
  20%, 80% { background-color: #111; }
  40%, 60% { background-color: #222; }
}

.flicker {
  animation: screenFlicker 1s ease-in-out;
}
</style>
</head>
<body>
  <h1>üíª Do You Want to Play? üíÄ</h1>

  <div id="start-screen">
    <p>It‚Äôs 6:59 PM. The office is empty. Do you dare to start?</p>
    <button id="start-btn" class="choice-btn">‚ñ∂Ô∏è Start Game</button>
  </div>

  <div id="game" style="display:none">
    <div id="story"></div>
    <div id="choices"></div>
  </div>

  <button id="mute-btn" style="display:none">üîä Sound On</button>

  <!-- Local audio files (added to /assets/audio/) -->
  <audio id="bgMusic" src="assets/audio/bg.mp3" loop preload="auto"></audio>
  <audio id="typingSound" src="assets/audio/typing.mp3" preload="auto"></audio>
  <audio id="flickerSound" src="assets/audio/flicker.mp3" preload="auto"></audio>
  <audio id="whisperSound" src="assets/audio/whisper.mp3" preload="auto"></audio>

<script>
const story = {
  "start": {
    "text": "üëÄ *6:59 PM.* Everyone‚Äôs gone. The hum of the lights feels louder than usual. You‚Äôre about to shut down your PC when an email pops up:\n*From:* unknown@officecorp.com\n*Subject:* Do you want to play?",
    "choices": [
      {"text": "Open the email üìß", "next": "open_email"},
      {"text": "Ignore it üôà", "next": "ignore_email"}
    ]
  },
  "open_email": {
    "text": "üì© The email simply says: *‚ÄòWe know you stayed late. Let‚Äôs play a game. Find the red folder.‚Äô*\nA faint *footstep* echoes down the hall ‚Äî but you‚Äôre alone... right?",
    "choices": [
      {"text": "Search your desk üóÑÔ∏è", "next": "search_desk"},
      {"text": "Check the hallway üö∂", "next": "search_hallway"}
    ]
  },
  "ignore_email": {
    "text": "‚ö° The lights flicker. Another message appears instantly: *‚ÄòYou can‚Äôt hide from me.‚Äô*\nSomething moves on your monitor‚Äôs reflection ‚Äî but nothing‚Äôs behind you.",
    "choices": [
      {"text": "Go check the email üìß", "next": "open_email"},
      {"text": "Hide under your desk ü™ë", "next": "hide_desk"}
    ]
  },
  "search_desk": {
    "text": "You open your drawer. A *red folder* slides forward on its own. Inside, a note reads:\n*‚ÄòWhen the clock strikes 10, you must choose your door.‚Äô* ‚è∞\nThe second hand ticks louder with every breath.",
    "choices": [
      {"text": "Head to the break room üçµ", "next": "break_room"},
      {"text": "Try the exit door üö™", "next": "exit_door"}
    ]
  },
  "search_hallway": {
    "text": "The hallway lights buzz overhead. A silhouette stands at the far end, motionless. When you blink ‚Äî it‚Äôs gone.\nA door creaks open near the conference room.",
    "choices": [
      {"text": "Follow the sound üë§", "next": "conference_room"},
      {"text": "Retreat to your desk üñ•Ô∏è", "next": "search_desk"}
    ]
  },
  "hide_desk": {
    "text": "You crawl under your desk. Silence‚Ä¶ then the printer starts printing a page by itself: *‚ÄòStand up.‚Äô* üñ®Ô∏è\nThe paper keeps sliding out ‚Äî blank, blank, blank ‚Äî until one shows your name.",
    "choices": [
      {"text": "Stand up üßç", "next": "search_desk"},
      {"text": "Stay hidden ü´£", "next": "stay_hidden"}
    ]
  },
  "break_room": {
    "text": "You enter the break room. The clock reads *9:59.* Three coffee cups sit in a row ‚Äî one trembling slightly.\nA whisper brushes your ear: *‚ÄòChoose carefully.‚Äô*",
    "choices": [
      {"text": "Pick left cup üü¢", "next": "key_left"},
      {"text": "Pick middle cup üü°", "next": "key_middle"},
      {"text": "Pick right cup üî¥", "next": "key_right"}
    ]
  },
  "exit_door": {
    "text": "You reach the exit. The glass reflects the office behind you ‚Äî except the reflection isn‚Äôt moving.\nIt slowly smiles. üò≥",
    "choices": [
      {"text": "Look for a key üóùÔ∏è", "next": "break_room"},
      {"text": "Try another exit üèÉ", "next": "other_exit"}
    ]
  },
  "conference_room": {
    "text": "The door creaks open. It‚Äôs dark. A chair slowly turns toward you ‚Äî empty.\nThen the overhead projector flickers on by itself, showing a slide: *‚ÄòWrong room.‚Äô*",
    "choices": [
      {"text": "Run to your desk", "next": "search_desk"},
      {"text": "Leave quickly üôÖ", "next": "other_exit"}
    ]
  },
  "stay_hidden": {
    "text": "From under the desk, you hear faint typing on your keyboard. A soft whisper follows:\n*‚ÄòTime‚Äôs up.‚Äô* The monitor glows with your own login ‚Äî but the hands on the keyboard aren‚Äôt yours. ‚è±Ô∏è",
    "choices": [
      {"text": "Crawl toward the hallway üêõ", "next": "conference_room"},
      {"text": "Peek at the desk üëÄ", "next": "search_desk"}
    ]
  },
  "key_left": {
    "text": "‚úÖ The left cup hides a small brass key. The whisper fades. You sprint to the exit, unlock it, and feel the cool night air ‚Äî free at last.\n‚Ä¶until your phone buzzes: *‚ÄòSee you tomorrow, player one.‚Äô* üéâ",
    "choices": []
  },
  "key_middle": {
    "text": "‚ùå The middle cup rattles ‚Äî empty. The lights flicker, then cut out.\nWhen they return, your reflection in the microwave is smiling back. And it doesn‚Äôt stop smiling. üò®",
    "choices": []
  },
  "key_right": {
    "text": "‚ùå The right cup contains only a candy ‚Äî and a note beneath it: *‚ÄòToo sweet. Too slow.‚Äô*\nThe break room door locks behind you as the clock strikes 10. Tick. Tick. Silence. ‚è∞",
    "choices": []
  },
  "other_exit": {
    "text": "‚úÖ You burst into the emergency stairwell. Freedom!\nYou laugh, catching your breath ‚Äî until your office access card *slides under the stair door from the inside.* üèÉ‚Äç‚ôÇÔ∏èüí®",
    "choices": []
  }
};

const storyDiv = document.getElementById('story');
const choicesDiv = document.getElementById('choices');
const startScreen = document.getElementById('start-screen');
const game = document.getElementById('game');
const startBtn = document.getElementById('start-btn');
const muteBtn = document.getElementById('mute-btn');

const bgMusic = document.getElementById('bgMusic');
const typingSound = document.getElementById('typingSound');
const flickerSound = document.getElementById('flickerSound');
const whisperSound = document.getElementById('whisperSound');

let soundEnabled = true;

/* ---------- audio error logging (helps debugging) ---------- */
[bgMusic, typingSound, flickerSound, whisperSound].forEach(a => {
  a.addEventListener('error', (e) => {
    console.error('Audio load error for', a.src, e);
  });
});

/* ---------- typewriter (plays typing sound) ---------- */
function typeWriterEffect(text, callback){
  storyDiv.textContent = '';
  let i=0;
  if(soundEnabled){ try{ typingSound.currentTime=0; typingSound.play().catch(()=>{}); }catch(e){} }
  const t = setInterval(()=>{
    storyDiv.textContent += text.charAt(i) || '';
    i++;
    if(i>=text.length){
      clearInterval(t);
      try{ typingSound.pause(); typingSound.currentTime=0; }catch(e){}
      setTimeout(callback, 420);
    }
  }, 28);
}

/* ---------- render scene ---------- */
function playScene(key) {
  const scene = story[key];
  if (!scene) return;
  choicesDiv.innerHTML = '';

  // check for keywords
  const textLower = scene.text.toLowerCase();
  const hasWhisper = textLower.includes("whisper");
  const hasFlicker = textLower.includes("flicker");

  typeWriterEffect(scene.text, () => {
    // üëª whisper sound effect
    if (soundEnabled && hasWhisper) {
      whisperSound.currentTime = 0;
      whisperSound.play().catch(() => {});
    }

    // üí° flicker effect (sound + visual)
    if (soundEnabled && hasFlicker) {
      // play sound
      flickerSound.currentTime = 0;
      flickerSound.play().catch(() => {});

      // screen flicker animation
      document.body.classList.add('flicker');
      setTimeout(() => {
        document.body.classList.remove('flicker');
      }, 1200); // lasts ~1.2s
    }

    // random small flickers if nothing special in text
    if (soundEnabled && !hasWhisper && !hasFlicker && Math.random() < 0.2) {
      flickerSound.currentTime = 0;
      flickerSound.play().catch(() => {});
    }

    // show choices
    if (!scene.choices || scene.choices.length === 0) {
      const b = document.createElement('button');
      b.textContent = 'üîÅ Play Again';
      b.className = 'choice-btn';
      b.onclick = () => playScene('start');
      choicesDiv.appendChild(b);
    } else {
      scene.choices.forEach(c => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.textContent = c.text;
        btn.onclick = () => playScene(c.next);
        choicesDiv.appendChild(btn);
      });
    }
  });
}

/* ---------- Start (user interaction required to enable audio) ---------- */
startBtn.addEventListener('click', async () => {
  // show game, hide start
  startScreen.style.display='none';
  game.style.display='block';
  muteBtn.style.display='inline-block';

  // ensure audio playback is allowed -> attempt play then pause if muted
  try{
    await bgMusic.play();
    bgMusic.pause();
    bgMusic.currentTime = 0;
  }catch(e){
    console.warn('Autoplay prevented; will play after first user gesture.');
  }

  // start background if sound enabled
  if(soundEnabled){
    bgMusic.volume = 0.28;
    bgMusic.play().catch(()=>{ /* ignore */ });
  }

  playScene('start');
});

/* ---------- Mute toggle ---------- */
muteBtn.addEventListener('click', () => {
  soundEnabled = !soundEnabled;
  muteBtn.textContent = soundEnabled ? 'üîä Sound On' : 'üîá Sound Off';
  if(soundEnabled){
    bgMusic.play().catch(()=>{});
  } else {
    bgMusic.pause();
    try{ typingSound.pause(); flickerSound.pause(); whisperSound.pause(); }catch(e){}
  }
});

/* ---------- initial UI state ---------- */
game.style.display='none';
muteBtn.style.display='none';
</script>
</body>
</html>